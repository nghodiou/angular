(window.webpackJsonp=window.webpackJsonp||[]).push([[268],{"+KrQ":function(t,e,i){var n=i("LboF"),a=i("Kffw");"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[t.i,a,""]]);var s={insert:"head",singleton:!1};n(a,s);t.exports=a.locals||{}},"83Cg":function(t,e,i){},BXAO:function(t,e,i){var n=i("LboF"),a=i("troe");"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[t.i,a,""]]);var s={insert:"head",singleton:!1};n(a,s);t.exports=a.locals||{}},IFjL:function(t,e,i){var n=i("LboF"),a=i("83Cg");"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[t.i,a,""]]);var s={insert:"head",singleton:!1};n(a,s);t.exports=a.locals||{}},IGUZ:function(t,e,i){"use strict";i.d(e,"b",(function(){return h})),i.d(e,"a",(function(){return u})),i.d(e,"c",(function(){return g}));var n=i("yXPU"),a=i.n(n),s=(i("5s+n"),i("iAnd")),o=i("NRfZ"),r=i("oCYn");function l(t){return d.apply(this,arguments)}function d(){return(d=a()((function*(t){var e=yield s.a.formTempFileUpload(t);if(e.fileId)return e;e.errorCode&&(2===e.errorCode?(yield s.a.createUser())&&(yield l(t)):6===e.errorCode&&r.default.prototype.$root.upgradePopup("fileSpace"))}))).apply(this,arguments)}function c(){return(c=a()((function*(t){return yield new Promise(e=>{var i=new FileReader;i.onload=function(){var i=a()((function*(i){var n=document.createElement("img");n.src=i.target.result;var a=document.createElement("canvas"),s=a.getContext("2d");n.onload=function(){n.width>750&&(a.width=750),a.height=a.width*(n.height/n.width);var i=document.createElement("canvas"),o=i.getContext("2d");i.width=n.width,i.height=n.height,o.drawImage(n,0,0,i.width,i.height),o.drawImage(i,0,0,i.width,i.height),s.drawImage(i,0,0,i.width,i.height,0,0,a.width,a.height),a.toBlob(i=>{var n=new File([i],t.name,{type:"image/jpeg",lastModified:(new Date).getTime()});e(n)})}}));return function(t){return i.apply(this,arguments)}}(),i.readAsDataURL(t)})}))).apply(this,arguments)}var h=class{constructor(t,e){this.quill=t,this.options=e}upload(t){var e=this;return a()((function*(){var i=new FormData,n=yield function(t){return c.apply(this,arguments)}(t);i.append("file",n),i.append("formId",e.options.formId),i.append("formSession",e.options.uploadSession),r.default.prototype.$setAppVueVariable("showMainLoader",!0);var a=yield l(i);if(a)return new Promise(t=>{setTimeout(()=>{var i={src:o.a.fileApi+"/tempfile/"+e.options.formId+"/"+a.fileId,alt:a.fileId},n=e.quill.getSelection(),s=-1;n&&(s=n.index),e.quill.insertEmbed(s,"image",i.src);var l=document.querySelector('img[src="'.concat(i.src,'"]'));l&&l.setAttribute("alt",i.alt),r.default.prototype.$setAppVueVariable("showMainLoader",!1),t(a)},100)});r.default.prototype.$setAppVueVariable("showMainLoader",!1)}))()}};var u=class{constructor(t,e){this.quill=t,this.options=e}insert(t){var e=this.quill.getSelection(),i=-1;e&&(i=e.index),this.quill.insertEmbed(i,"video",t)}},f=i("kzlf"),p=i.n(f).a.import("blots/embed");class m extends p{static create(t){var e=super.create(t);return e.innerHTML=t.label+'<span class="ql-tag-close" onClick="this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);"></span>',e.setAttribute("data-value",t.value),e.setAttribute("data-label",t.label),e}static value(t){return{label:t.dataset.label,value:t.dataset.value}}}m.blotName="tag",m.className="tag",m.tagName="span";var g=m},Kffw:function(t,e,i){},RI16:function(t,e,i){"use strict";var n=function(){var t,e=this,i=e._self._c;return i("div",{staticClass:"tag-editor-wrapper",class:{"single-line":e.singleLine},style:{"--tip-text":"'".concat(e.tipText,"'")}},[i("ITextBubbleEditor",{ref:"editor",attrs:{allowedEditorExtensions:e.noTextStyle?{}:e.allowedEditorExtensions,enableTag:!0,placeholder:e.placeholder,contenteditable:e.contenteditable,singleLine:e.singleLine},on:{editor:e.initEditor,input:e.onUpdateBBCodeEditor,focus:function(t){return e.$emit("focus",t)},delta:e.onChange,keypressEnter:e.pressEnter},model:{value:e.editorContent,callback:function(t){e.editorContent=t},expression:"editorContent"}},[i("div",{staticClass:"tag-add-button-wrapper",class:{"single-line":e.singleLine}},[e.noPlusButton?e._e():i("i-button",{staticClass:"tag-add-button",attrs:{naked:""},on:{click:e.addAt}},[i("i-icon",{staticClass:"tag-add-icon",attrs:{icon:"plus"}})],1)],1),e._v(" "),e._t("default")],2),e._v(" "),e.exceededMaxCharacter?i("span",{staticClass:"max-length-error"},[e._v(e._s(e.$t("questionTypes.validationErrors.maxCharacters",{field:e.maxCharacter.fieldName,max:e.maxCharacter.length})))]):e._e(),e._v(" "),e.isOpenTagList&&(null===(t=e.variables)||void 0===t?void 0:t.length)>0?i("TagList",{attrs:{position:e.position,variables:e.variables,headerTitle:e.headerTitle,editor:e.editor,searchTag:e.searchTag},on:{closeList:e.closeList,addVariable:e.addVariable}}):e._e()],1)};n._withStripped=!0;i("SYor");var a=i("kksK"),s=i("lFpY"),o=function(){var t=this,e=t._self._c;return t.position?e("div",{staticClass:"variable-list",style:{top:t.position.top+20+"px",left:t.$root.isMobile?"unset":t.position.right+20+"px"}},[t.headerTitle?e("h3",[t._v(t._s(t.headerTitle))]):t._e(),t._v(" "),t._l(t.filteredTags,(function(i,n){return e("div",{key:n,staticClass:"variable-item",class:{selected:t.selectedItemIndex===n},on:{click:function(e){return t.$emit("addVariable",i)},mouseover:function(e){t.selectedItemIndex=n}}},[i.image?e("img",{attrs:{src:i.image}}):t._e(),t._v(" "),e("p",[t._v(t._s(i.label))])])})),t._v(" "),0===t.filteredTags.length?e("div",{staticClass:"variable-item"},[t._v("\n\t\t"+t._s(t.$t("formSettings.notificationSettings.customNotifications.noResult"))+"\n\t")]):t._e()],2):t._e()};o._withStripped=!0;i("rB9j"),i("hByQ"),i("TWNs"),i("JfAA");var r={name:"TagList",props:{variables:Array,position:Object,editor:Object,searchTag:String,headerTitle:String},data:function(){return{selectedItemIndex:0,lastSearchResultLength:-1}},mounted:function(){this.selectedItemIndex=0,this.lastSearchResultLength=-1,document.addEventListener("keydown",this.onKeyDown,!1)},beforeDestroy:function(){document.removeEventListener("keydown",this.onKeyDown,!1)},methods:{onKeyDown:function(t){switch(t.keyCode){case 37:case 39:t.preventDefault();break;case 38:t.preventDefault(),this.selectedItemIndex>0&&this.selectedItemIndex--;break;case 40:t.preventDefault(),this.selectedItemIndex+1<this.filteredTags.length&&this.selectedItemIndex++;break;case 13:if(this.selectedItemIndex>-1){t.preventDefault();var e=this.editor.getSelection();e&&this.editor.updateContents([{retain:e.index-1},{delete:1}]),this.$emit("addVariable",this.filteredTags[this.selectedItemIndex])}}}},computed:{filteredTags:function(){if(!this.searchTag)return this.variables;var t=this.variables.filter(t=>t.label.search(new RegExp(this.searchTag,"i"))>-1);return this.selectedItemIndex=t.length>0?0:-1,t.length>0?this.lastSearchResultLength=this.searchTag.length:this.lastSearchResultLength+3<this.searchTag.length&&this.$emit("closeList"),t}}},l=(i("lX0j"),i("KHd+")),d=Object(l.a)(r,o,[],!1,null,"c12e95d4",null).exports,c={name:"TagEditor",props:{value:String,form:Object,variables:Array,singleLine:Boolean,noTextStyle:Boolean,contenteditable:Boolean,noPlusButton:Boolean,headerTitle:String,tipText:String,placeholder:String,onFocus:String,maxCharacter:{length:Number,fieldName:String},allowedEditorExtensions:{type:Object,default:function(){return{Bold:!0,Italic:!0,Link:!0,Underline:!0,Heading:!0}}}},components:{ITextBubbleEditor:a.a,TagList:d},data:function(){return{setContentTimeout:null,content:null,editorContent:"",editor:null,position:null,lastRetain:-1,searchTag:"",exceededMaxCharacter:!1}},created:function(){this.setEditorContent()},methods:{initEditor:function(t){this.editor=t},onUpdateBBCodeEditor:function(t){if(!this.isOpenTagList){var e=s.a.htmlToBBCode(t);this.noTextStyle&&(e=s.a.cleanTextFromBBCode(e)),this.maxCharacter&&(this.exceededMaxCharacter=s.a.cleanTextFromHtml(t).length>this.maxCharacter.length,this.exceededMaxCharacter)?this.$emit("valid",!1):(this.$emit("valid",!!t),e!==this.value&&this.$emit("input",e))}},onChange:function(t){if(this.$emit("change"),this.isOpenTagList){var e=t.ops.find(t=>t.retain),i=-1;return e&&e.retain&&(i=e.retain),i===this.lastRetain?(this.position=null,void(this.searchTag="")):void(this.searchTag=this.editor.getText(Math.max(this.lastRetain,0)+1,i-(this.lastRetain>-1?this.lastRetain:0)).trim())}this.searchTag="";var n=t.ops.find(t=>t.insert);if(n&&"@"===n.insert){var a=this.editor.getSelection();this.position=this.editor.getBounds(a.index);var s=t.ops.find(t=>t.retain);this.lastRetain=s?s.retain:-1}else n&&"\n"===n.insert||(this.position=null)},addVariable:function(t){var e=this.editor.getSelection(!0);if(e){if(-1===this.lastRetain){var i=this.editor.getText().length===this.searchTag.length+1?0:1;this.editor.updateContents([{delete:this.searchTag.length+i}]),this.editor.insertEmbed(0,"tag",t),this.editor.setSelection(1)}else this.editor.insertEmbed(e.index,"tag",t),this.editor.updateContents([{retain:this.lastRetain},{delete:this.searchTag.length+1}]),this.editor.setSelection(e.index);e=this.editor.getSelection(!0),this.editor.insertText(e.index," "),this.position=null,this.searchTag="",this.$emit("addVariable",t)}},addAt:function(){var t=this.editor.getSelection(!0);t&&setTimeout(()=>{this.editor.insertText(t.index,"@")},50)},closeList:function(){this.position=null},setContent:function(t){this.editor&&this.editor.setHTML(s.a.bbcodeToHtml(t,this.form))},focus:function(){this.$refs.editor.focus()},pressEnter:function(t){var e=s.a.cleanTextFromHtml(s.a.cleanTextFromBBCode(this.editorContent));(e=e.trim())?this.$emit("enter",t):this.$nextTick(()=>{this.setContent("")})},setEditorContent:function(t){this.editorContent=s.a.bbcodeToHtml(t||this.value,this.form),t&&this.editor.setHTML(this.editorContent)}},computed:{isOpenTagList:function(){return this.position?document.addEventListener("click",this.closeList):document.removeEventListener("click",this.closeList),this.position}}},h=(i("Xmtd"),Object(l.a)(c,n,[],!1,null,"c0cd07c4",null));e.a=h.exports},Xmtd:function(t,e,i){"use strict";i("BXAO")},cd46:function(t,e,i){"use strict";i("+KrQ")},kksK:function(t,e,i){"use strict";var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"editor",class:{"hide-toolbar":!t.visibleExtensions}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.visibleExtensions,expression:"visibleExtensions"}],ref:"toolbar",staticClass:"toolbar"},[t.allowedEditorExtensions.Bold?e("button",{staticClass:"ql-bold",attrs:{icon:"bold",tabindex:"-1"}},[e("icon",{staticClass:"text-editor-icon",attrs:{name:"bold"}})],1):t._e(),t._v(" "),t.allowedEditorExtensions.Italic?e("button",{staticClass:"ql-italic",attrs:{icon:"italic",tabindex:"-1"}},[e("icon",{staticClass:"text-editor-icon",attrs:{name:"italic"}})],1):t._e(),t._v(" "),t.allowedEditorExtensions.Underline?e("button",{staticClass:"ql-underline",attrs:{icon:"underline",tabindex:"-1"}},[e("icon",{staticClass:"text-editor-icon",attrs:{name:"underline"}})],1):t._e(),t._v(" "),t.allowedEditorExtensions.Heading?e("button",{staticClass:"ql-header",attrs:{value:"1",tabindex:"-1"}},[t._v("\n\t\t\tH1\n\t\t")]):t._e(),t._v(" "),t.allowedEditorExtensions.Heading?e("button",{staticClass:"ql-header",attrs:{value:"2",tabindex:"-1"}},[t._v("\n\t\t\tH2\n\t\t")]):t._e(),t._v(" "),t.allowedEditorExtensions.Heading?e("button",{staticClass:"ql-header",attrs:{value:"3",tabindex:"-1"}},[t._v("\n\t\t\tH3\n\t\t")]):t._e(),t._v(" "),t.allowedEditorExtensions.Link?e("button",{staticClass:"ql-link",attrs:{icon:"link",tabindex:"-1"}},[e("icon",{staticClass:"text-editor-icon",attrs:{name:"link"}})],1):t._e()]),t._v(" "),e("div",{ref:"editor"}),t._v(" "),t._t("default")],2)};n._withStripped=!0;var a,s=i("yXPU"),o=i.n(s),r=i("qGYk"),l=i("kzlf"),d=i.n(l),c=i("IGUZ"),h={name:"ITextBubbleEditor",props:{contenteditable:Boolean,value:{type:[String,Number],default:""},allowedEditorExtensions:Object,enableTag:Boolean,singleLine:Boolean,placeholder:String},components:{Icon:r.a},data:function(){return{editor:null}},mounted:(a=o()((function*(){var t=this;this.enableTag&&d.a.register({"formats/tag":c.c});for(var e=d.a.import("ui/icons"),i=this.$refs.toolbar.children,n=0;n<i.length;n++){var a=i[n];a.attributes.icon&&(e[a.attributes.icon.value]=a.children[0])}this.editor=new d.a(this.$refs.editor,{modules:{toolbar:this.$refs.toolbar},placeholder:this.placeholder,theme:"bubble",formats:{break:"br"}}),this.editor.setHTML=t=>{this.editor.setContents(this.editor.clipboard.convert(t),"silent")},this.editor.on("editor-change",(function(e){t.editorUpdate(t.editor.root.innerHTML)})),this.editor.on("text-change",t=>{this.$emit("delta",t)}),this.value&&this.editor.setHTML(this.value),this.$emit("editor",this.editor),this.editor.root.addEventListener("click",()=>{this.$emit("focus",this.editor.root)}),this.editor.root.addEventListener("keydown",t=>{13===t.keyCode&&this.$emit("keypressEnter",t.metaKey)}),this.$nextTick(()=>{this.editor.theme.tooltip.root.querySelector("input[data-link]").dataset.link="https://example.com"})})),function(){return a.apply(this,arguments)}),beforeDestroy:function(){this.editor.root.removeEventListener("click",()=>{this.$emit("focus",this.editor.root)})},methods:{editorUpdate:function(t){this.singleLine&&(0===t.indexOf("<p>")&&(t=t.substring(3,t.length-4)));"<br>"===t&&(t=""),this.$emit("input",t)},setContent:function(t){this.editor.setHTML(t)},focus:function(){this.editor.focus(),this.$emit("focus",this.editor.root)}},computed:{visibleExtensions:function(){return this.allowedEditorExtensions&&Object.keys(this.allowedEditorExtensions).length>0}}},u=(i("cd46"),i("KHd+")),f=Object(u.a)(h,n,[],!1,null,"f9c54ea4",null);e.a=f.exports},lFpY:function(t,e,i){"use strict";i("JfAA"),i("rB9j"),i("UxlC"),i("TWNs");var n=i("RuLz"),a=i("ttAG"),s=i("mSNy"),o=i("K/kh"),r=Object(n.a)(),l=r.bbcodeParser,d=r.bbCodeHelper;d.addBBCode("{{{TEXT}}}",'<span class="tag" data-value="{TEXT}" data-label="{TEXT2}>\ufeff<span contenteditable="false">{TEXT2}</span>\ufeff</span>');var c={q:function(t,e,i){var n=e.questions.filter(t=>{var e=o.a.getQuestionTypeByTypeName(t.questionType.toLowerCase());return!(!e||!e.answerable)});i&&i.length>4&&(t=i[4]);var a=n.findIndex(e=>e._id===t);return a>-1?a+1+". "+r.cleanTextFromBBCode(n[a].question):null},">formAnswers":function(){return s.default.t("formSettings.notificationSettings.customNotifications.labels.formAnswers")},mentions:function(t,e){var i=e[t];return i?"@"+i.fullname:"@member"}};e.a={bbcodeToHtml:function(t,e){if(!t)return"";t=a.default.clearHtmlTags(t);for(var i=0;i<l.bbcode_matches.length;i+=1)if(l.bbcode_matches[i].toString()===d.getRegEx("{{{TEXT}}}").toString()){var n=h(t,"{{"+l.tokens.TEXT+"}}");if(n)for(var o=0;o<n.length;o++){var r=n[o],u=d.getRegEx("{{{TEXT}}}",!0),f=r.split("."),p=f[0],m="";if(e&&c[p]){var g=f[1];m=c[p](g,e,f)}else m=s.default.t("formSettings.notificationSettings.customNotifications.labels."+r);var v=h(m,"{{"+l.tokens.TEXT+"}}");v&&v.length>0&&(m=m.replace(u,"__")),t=m?t.replace(u,'<span class="tag" data-value="'.concat(r,'" data-label="').concat(m,'">\ufeff<span>').concat(m,"</span>\ufeff</span>")):t.replace(u,"")}}else t=t.replace(l.bbcode_matches[i],l.html_tpls[i]);return t},htmlToBBCode:r.htmlToBBCode,cleanTextFromBBCode:r.cleanTextFromBBCode,cleanTextFromHtml:r.cleanTextFromHtml};var h=function(t,e){var i,n=[];if((e=new RegExp(e,"g")).global)for(;i=e.exec(t);)n.push(i[1]);else(i=e.exec(t))&&n.push(i[1]);return n}},lX0j:function(t,e,i){"use strict";i("IFjL")},troe:function(t,e,i){}}]);